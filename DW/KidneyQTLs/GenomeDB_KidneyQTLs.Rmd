---
title: "GenomeDB_KidneyQTLs"
author: "Nick Burns"
date: "15 August 2016"
output: html_document
---

## GenomeDB: Kidney QTLs  

Time to load the kidney QTLs. The datasets are both quite small, but there will be a fair amount of effort required to describe and document this data.

Obviously, I need to get both the gene expression and the QTL data into the data warehouse.

```{r}
library(data.table)
setwd("G:/Datasets/GenomicsDatasets/eQTLData/All eQTL with 2x P0.05/")
list.files(".")

qtl <- fread("Fisher_Final_Annot.csv")
qtl <- qtl[, .(dbSNP.RS.ID, fisher.P, Chromosome, Physical.Position, Associated.Gene)]
dim(qtl)
qtl
```

OMG this is going to be a nightmare. Look at that Associated.Gene column... yuck yuck yuck yuck yuck!!!! Wow. This will take some effort. Need to develop a function to parse this mess.

```{r}
parse_assoc_genes <- function (x) {
    
    gene_entry <- unlist(strsplit(x, "///"))
    
    gene_names <- lapply(gene_entry,
                         function (g) {
                             
                             tmp <- unlist(strsplit(g, "//"))
                             gene <- gsub(" ", "", tmp[5])
                             return (gene)
                         })
    return (unlist(gene_names))
}

testA <- "NM_000982 // upstream // 429974 // Hs.381123 // RPL21 // 6144 // ribosomal protein L21 /// NM_022906 // downstream // 889758 // Hs.632013 // STAG3L4 // 64940 // stromal antigen 3-like 4 /// ENST00000403018 // upstream // 1388869 // Hs.654801 // AUTS2 // 26053 // autism susceptibility candidate 2 /// ENST00000352103 // downstream // 890889 // Hs.632013 // STAG3L4 // 64940 // stromal antigen 3-like 4"
parse_assoc_genes(testA)
```

Wow. It gets worse. IF we take this first SNP as an example, it maps to 4 different genes, but there is only one pvalue. What does this mean?

Have emailed James to get a link to the original paper. Failing that, we will have to rerun the analyses.